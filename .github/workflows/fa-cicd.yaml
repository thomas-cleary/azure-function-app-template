name: 'Function App - CI/CD'

on:
  push:
    paths:
      - 'src/**'
      - '.github/**/fa**.yaml'

  workflow_dispatch:

env:
  PROJECT_KEY: afat

jobs:
  deploy_dev:
    name: Deploy to DEV
    uses: ./.github/workflows/fa-deploy.yaml
    with:
      gha_env: DEV
      env_key: dev
      project_key: ${{ env.PROJECT_KEY }}
    secrets:
      azure_credentials: ${{ secrets.AZURE_CREDENTIALS }}

  deploy_test:
    name: Deploy to TEST
    if: github.ref_name == 'main'
    needs: deploy_dev
    uses: ./.github/workflows/fa-deploy.yaml
    with:
      gha_env: TEST
      env_key: test
      project_key: ${{ env.PROJECT_KEY }}
    secrets:
      azure_credentials: ${{ secrets.AZURE_CREDENTIALS }}

  deploy_prd:
    name: Deploy to PRD
    needs: deploy_test
    uses: ./.github/workflows/fa-deploy.yaml
    with:
      gha_env: PRD
      env_key: prd
      project_key: ${{ env.PROJECT_KEY }}
    secrets:
      azure_credentials: ${{ secrets.AZURE_CREDENTIALS }}
